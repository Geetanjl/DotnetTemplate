# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
 branches:
    include:
    - main 
    - Release/*

variables:
   major: 1
   minor: 0
   patch: 0
name: $(major).$(minor).$(patch)$(Rev:.r)
stages:
- stage: build
  jobs:
  - job: build_backend_job
    pool:
      #name: 'VSC'
      vmImage: 'windows-latest'
    steps:
      - task: UseDotNet@2
        inputs:
          packageType: 'sdk'
          version: '6.x'

      -  task: DotNetCoreCLI@2
         displayName: Dotnet restore
         inputs:
           command: 'restore'
           projects: 'DotnetTemplate.sln'
           feedsToUse: 'select'
           configuration: Release
      - task: DotNetCoreCLI@2
        displayName: Dotnet run
        inputs:
          command: 'run'
          projects: 'DotnetTemplate/DotnetTemplate.sln'
      - task: DotNetCoreCLI@2
        displayName: Dotnet build
        inputs:
          command: 'build'
          projects: 'DotnetTemplate/DotnetTemplate.sln'
          workingDirectory: 'DotnetTemplate'

      - task: DotNetCoreCLI@2
        displayName: Dotnet test
        inputs:
          command: 'test'
          projects: 'DotnetTemplate/DotnetTemplate.sln'
          configuration: Release
      - task: PublishBuildArtifacts@1
        displayName: Build artifact
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: 'Backend'
          publishLocation: 'Container'